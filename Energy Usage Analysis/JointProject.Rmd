---
title: "Joint Project"
author: "Kaylee Jacqueline"
date: "2024-04-10"
output:
  html_document:
    toc: yes
    toc_float:
      collapsed: no
      smooth_scroll: no
    number_sections : true
  pdf_document:
    toc: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


# Data Cleaning

## Importing libraries
```{r lib, message=FALSE, warning=FALSE}
library(dplyr)
library(tidyverse)
library(car)
```

## Importing the datasets 
```{r setwd + import csv}
#setwd("C:/Users/ASUS/OneDrive - Dundalk Institute of Technology/Joint Project")
hourly_dublin = read.csv("hourly_dublin_17_18_19.csv")
home_power = read.csv("JLHome1718Power.csv")
home_temp = read.csv("JLHome1718Temperature.csv")
```

## Changing the date type
I need to specify the timezone as GMT as it automatically use the BST Timezone, but in the data, there is no transition:

- to Irish Standard Time (GMT+1) occurred on Sunday, 29th October 2017.
- to Irish Summer Time (GMT+2) occurred on Sunday, 25th March 2018.
- to Irish Standard Time (GMT+1) occurred on Sunday, 28th October 2018.
- to Irish Summer Time (GMT+2) occurred on Sunday, 31st March 2019.
- to Irish Standard Time (GMT+1) occurred on Sunday, 27th October 2019.

So I decided to just use the GMT Timezone where there is no time change.
```{r date}
hourly_dublin$date = as.POSIXct(hourly_dublin$date, format = "%d/%m/%Y %H:%M", tz = "GMT")
home_power$date = as.POSIXct(home_power$date, format = "%d/%m/%Y %H:%M", tz = "GMT")
home_temp$date = as.POSIXct(home_temp$date, format = "%d/%m/%Y %H:%M", tz = "GMT")
```


## Merge the datasets
In order to analyze the data, I need to combine all three datasets into 1 table. As we can see, the home_power data has a time interval for every minute, while the home_temp data has a time interval for every 5 minutes. So, I decided to unify the time interval for every 1 hour, and to match the time interval in hourly_dublin dataset. And here are the steps I take to achieve that:

### Calculate the hourly total power per day 
```{r total power per hour}
# extract the hour and date part from the datetime
home_power=home_power %>% mutate(hour = format(date, "%H"),
                                 date_2 = as.Date(date, format='%d/%m/%Y %H:%M'))

#group based on the date and per hour, and calculate the total power usage in that hour, then merge the date and hour to create a datetime column
hourly_power = home_power %>% group_by(date_2,hour) %>%
                              summarise(total_power = sum(power),.groups = 'drop') %>%
                              mutate(datetime = as.POSIXct(paste(date_2,hour),
                                                           format = "%Y-%m-%d %H", tz = "GMT"))
hourly_power=hourly_power %>% select(datetime,total_power)
#write.csv(hourly_power, "hourly_power.csv")
```
### Calculate hourly average temperature per day
```{r avg temp per hour}
# extract the hour and date part from the datetime
home_temp=home_temp %>% mutate(hour = format(date, "%H"),
                              date_2 = as.Date(date, format='%d/%m/%Y %H:%M'))
#group based on the date and per hour, and calculate the average temperature per hour, then merge the date and hour to create a datetime column
hourly_temp = home_temp %>% group_by(date_2,hour) %>%
                            summarise(avg_temp = round(mean(temp),digits = 2),.groups = 'drop') %>%
                            mutate(datetime = as.POSIXct(paste(date_2,hour),
                                                           format = "%Y-%m-%d %H", tz = "GMT"))
hourly_temp=hourly_temp%>% select(datetime,avg_temp)
#write.csv(hourly_temp, "hourly_temp.csv")
```
### Merge all three dataset with hourly time interval 
I decided to merge the hourly_power to hourly_temp first based on the datetime column, as I notice that the length of these two datasets are not the same, and hourly_temp has more rows. Then I merge them with the hourly_dublin dataset. I checked after merging and I notice that there are 29 rows where we don't have the data for total_power.

```{r merge dataset}
#merge temp and power
hourly_temp_power = merge(hourly_temp,hourly_power,all.x = TRUE)
#merge with hourly_dublin
hourly_data = merge(hourly_dublin, hourly_temp_power, by.x="date", by.y="datetime")
```

\newpage

# Initial Exploration
## Missing Values
We know that the hourly_dublin contains the data starting from 1-1-17 to 31-12-19. Meanwhile, our other two datasets cover a shorter time period from 12-10-17 to 13-10-19. As a result, we are missing data for Power and Temperature. Thus, my research will only consider the information that is available between 12 October, 2017, and 13 October, 2019.

As we can see from the summary of the hourly_data above, there are a total of 29 rows that have missing values for the total_power column.
```{r total_power NA}
#checking rows with na for total_power
na_rows <- which(rowSums(is.na(hourly_data)) > 0)
#timestamps where there's no total_power data
hourly_data[c(na_rows),c("date", "avg_temp","total_power")]
```
These are the dates where there is no record of the power usage. My guess on why there are missing values might be because there was a power shortage so the dataset does not contain the power usage during that time. Then, I decided to drop the NA values for further data analysis step.

```{r drop NA}
hourly_data_filtered = hourly_data %>% drop_na()
head(hourly_data_filtered,5)
```

## Data Wrangling
I am going to make new variables from the 'hourly_data_filtered' that I think will help in the analysis later on.
**case_when used from datacamp**

### 1. Format Date
a. Seasonal
Create a new variable called seasonal by formatting the date column into months and filter the months to categorize the based on seasons in Ireland. My categorization will be:

  - Spring: March, April, and May
  - Summer: June, July, and August
  - Fall: September, October, November
  - Winter: December, January, and February
```{r season}
hourly_data_filtered = mutate(hourly_data_filtered, month = as.numeric(format(date, "%m")))
hourly_data_filtered <- hourly_data_filtered %>%
  mutate(season = case_when(
    month %in% 3:5 ~ "Spring",
    month %in% 6:8 ~ "Summer",
    month %in% 9:11 ~ "Fall",
    month %in% c(12, 1, 2) ~ "Winter"
  ))
order <- c("Spring", "Summer", "Fall", "Winter")

hourly_data_filtered$season = factor(hourly_data_filtered$season, levels = order)
```


b. Time
I also categorized the time into 4 time period in a day.
  - Morning: 6am - 12pm
  - Afternoon: 1pm - 6pm
  - Evening: 7pm - 9 pm
  - Night: 10 pm - 5am
```{r time period}
hourly_data_filtered = mutate(hourly_data_filtered, time = as.numeric(format(date, "%H")))
hourly_data_filtered <- hourly_data_filtered %>%
  mutate(time_period = case_when(
    time %in% 6:12 ~ "Morning",
    time %in% 13:18 ~ "Afternoon",
    time %in% 19:21 ~ "Evening",
    time %in% c(22,23,0,1,2,3,4,5) ~ "Night"
  ))
order <- c("Morning", "Afternoon", "Evening", "Night")

hourly_data_filtered$time_period = factor(hourly_data_filtered$time_period, levels = order)
```

## 2. Rain Group
I tried to categorized when it is raining or not. I take 0 in the rain column as "No rain" and the rest will be "Rain".
```{r}
hourly_data_filtered = mutate(hourly_data_filtered,rain_group = ifelse(rain == 0, "No Rain", "Rain"))

hourly_data_filtered$rain_group = factor(hourly_data_filtered$rain_group)
```

## 3. Temperature difference
```{r}
hourly_data_filtered = mutate(hourly_data_filtered, temp_diff = (round(abs(avg_temp - temp),digits=2)))
```

## 4. Factor Sun
```{r}
hourly_data_filtered = mutate(hourly_data_filtered,sun_factor = ifelse(sun == 0, "No Sunlight", "Sun"))

hourly_data_filtered$sun_factor = factor(hourly_data_filtered$sun_factor)
```

## Data Introduction
Before the data cleaning, we had three datasets in total:

1. hourly_dublin contains weather data from Dublin Airport from 1-1-17 to 31-12-19. The weather data is recorded every hour.
2. home_power contains data from 12-10-17 to 13-10-19. This data measures the power usage in watts and each entry indicates the average usage over the previous minute.
3. home_temp contains data from 12-10-17 to 13-10-19. This data measures the temperature of the house in degrees Celsius and each entry indicates the average temperature of the house over the previous 5 minutes.


Then I combine the datasets into one based on the date column, with the time interval of one hour. And then I identify missing values and get rid of them to ensure data integrity. I also created new variables that I think will be useful for analysis. So, now this is the data that I will use starting from this point.
```{r hourly_data}
hourly_data_filtered = hourly_data_filtered %>% select(date, month, time, season, time_period, rain, rain_group, temp, avg_temp, temp_diff, rhum, wdsp, sun, sun_factor,vis, total_power)

summary(hourly_data_filtered)
str(hourly_data_filtered)
```
So for the hourly data, we have 16 columns and 17282 rows:

1. date       : The date and time from 2017-10-12 23:00:00.00 until 2019-10-13 18:00:00.00, with a time interval of 1 hour. -> Categorical Ordinal
2. month      : Month of the date column -> Categorical Ordinal
3. time       : Time of the date column -> Categorical Ordinal
4. season     : Season of the date, derived from the month -> Categorical Ordinal
5. time_period: Time period of the date, derived from the time -> Categorical Ordinal
6. rain       : Rain precipitation amount (mm) -> Continuous Numerical 
7. rain_group : Categorization of the rain column -> Categorical Ordinal
8. temp       : Air Temperature (°C) -> Continuous Numerical 
9. avg_temp   : Average Temperature in the house (°C) -> Continuous Numerical
10. temp_diff : The absolute difference between average temperature in the house and outside -> Continuous Numerical
11. rhum       : Relative Humidity (%) -> Discrete Numerical
12. wdsp       : Average Hourly Wind Speed (kt)-> Discrete Numerical
13. sun        : Sunshine duration (hours) -> Continuous Numerical 
14. sun_factor : Categorization of the sun column -> Categorical Ordinal
15. vis        : Visibility (m) -> Discrete Numerical
16. total_power: Total Power usage (watts) -> Discrete Numerical

**Even though I have a lot of columns, I think that later on I will not use some of the columns such as Sun and Rain because it will be useful if I use the new variable which is the categorization of those column**

\newpage

## Data visualisation
In this section, I will make univariate plots for each variable and interpret the results.

1. Rain

- I decided not to use the rain column because it is very skewed and I thought about doing data transformation such as log, but then I need to consider the 0 values which will be eliminated if I do so, and I proceed with the rain_group column to replace the rain column.
- Based on the plot of the rain_group, we can see that there are significantly more No rain occurance compared to rain
```{r rain1}
#hist(hourly_data_filtered$rain)
plot(hourly_data_filtered$rain_group)
```
2. Temperature 
Based on the histogram of Temperature, we can see that it is normally distributed and looks symmetric. Which mean that the mean, median, and mode should lie in the middle of the data which is around 9 to 10°C.
```{r temp}
hist(hourly_data_filtered$temp)
```
3. Rhum
Based on the histogram, we can see that the data is heavily skewed to the left, which mean that the Mean<Median<Mode. The median should lie around 85-90%. 
```{r rhum}
hist(hourly_data_filtered$rhum)
```
4. WDSP
Based on the histogram, we can see that the data is heavily skewed to the right, which mean that Mode<Median<Mean. The median should lie around 8-9 kt.
```{r wdsp}
#table(hourly_data_filtered$wdsp)
#hourly_data_filtered[which(hourly_data_filtered$wdsp>25),]

#outlier=which(hourly_data_filtered$wdsp>25)
hist(hourly_data_filtered$wdsp)
```
5. Sun
I decided not to use the Sun column as the visualisation is very skewed and proceed with the Sun_factor column. Based on the plot,w e can see that there are more occurrences of "No Sunlight" (Sun = 0) in the data. This explains the skewness of the data.

```{r sun}
#plot(factor(hourly_data_filtered$sun))
plot(hourly_data_filtered$sun_factor)
```
6. Vis
I did visualisations for the vis column but the data is ver skewed and it is not normally distributed. So I decided to use the log transformation and the histogram of log(vis) looks better even though it is still skewed and there are some outliers.
```{r vis}
#par(mfrow) = https://www.statmethods.net/advgraphs/layout.html
par(mfrow=c(2,2))
#table(hourly_data_filtered$vis)
hist(hourly_data_filtered$vis)
qqnorm(hourly_data_filtered$vis)
qqline(hourly_data_filtered$vis)
#look at log of power
hist(log(hourly_data_filtered$vis))
qqnorm(log(hourly_data_filtered$vis))
qqline(log(hourly_data_filtered$vis))

```
7. Avg_temp
Based on the histogram, the data looks a bit skewed as it has a few outliers, but it still look normally distributed with a median between 17-18 °C
```{r avg_temp}
hist(hourly_data_filtered$avg_temp)
```
8. Total_power
Based on the histogram, the data is very skewed as it has a lot of outliers at the end. The median for this data should be around 9000 watts.
```{r total_power}
par(mfrow=c(2,2))
#table(hourly_data_filtered$total_power)
hist(hourly_data_filtered$total_power)
qqnorm(hourly_data_filtered$total_power)
qqline(hourly_data_filtered$total_power)
#look at log of power
hist(log(hourly_data_filtered$total_power))
qqnorm(log(hourly_data_filtered$total_power))
qqline(log(hourly_data_filtered$total_power))
```

9. Temperature Difference
Fromm the histogram, we can see that the 'temp_diff' column seems to be skewed but it still looks to have a normal distribution.
```{r temp_diff}
hist(hourly_data_filtered$temp_diff)
```


## Descriptive statistics
We can see the descriptive statistics from the summary of 'hourly_data_filtered' in the previous section. But I made another descriptive statistics and the spread for the numerical columns beside sun and rain as they are very skewed because of all the zeros:

```{r}
sd_temp = sd(hourly_data_filtered$temp)
IQR_rhum = IQR(hourly_data_filtered$rhum)
IQR_wdsp = IQR(hourly_data_filtered$wdsp)
IQR_vis = IQR(log(hourly_data_filtered$vis))
sd_avg_temp = sd(hourly_data_filtered$avg_temp)
sd_temp_diff = sd(hourly_data_filtered$temp_diff)
mean_log_power = mean(log(hourly_data_filtered$total_power))
median_log_power = median(log(hourly_data_filtered$total_power))
IQR_power = IQR(log(hourly_data_filtered$total_power))
```

1. Temp:
  - Mean:9.8
  - Median:9.7
  - Spread (St. Dev): `r sd_temp`
  - Because the data looks normally distributed (not skewed), we will use mean as the measure of central tendency.
  - For the measure of spread we use standard deviation, and it means that most of the temperatures are within `r sd_temp` from the mean.
2. Humidity:
  - Mean:81.53336
  - Median:84
  - Spread (IQR): `r IQR_rhum`
  - Because the data is skewed, we use median as the measure of central tendency.
  - Majority of Humidity lies within `r IQR_rhum` of the median.
3. Wind:
  - Mean:9.855851
  - Median:9
  - Because the data is skewed, we use median as the measure of central tendency.
  - Majority of Wind level lies within `r IQR_wdsp` of the median.
4. log(Visual):
  - Mean:10.06695
  - Median:10.30895
  - Because the data is skewed, we use median as the measure of central tendency.
  - Majority of Visual level lies within `r IQR_vis` of the median.
5. Average temp:
  - Mean:16.44561
  - Median:16.3
  - Because the data looks normally distributed (not skewed), we will use mean as the measure of central tendency.
  - For the measure of spread we use standard deviation, and it means that most of the temperatures in the house are within `r sd_avg_temp` from the mean.
6. Temp difference:
  - Mean:6.623196
  - Median:6.45
  - Because the data looks normally distributed (not skewed), we will use mean as the measure of central tendency.
  - For the measure of spread we use standard deviation, and it means that most of the temperatures difference are within `r sd_temp_diff` from the mean.
7. log(Total power):
  - Mean:`r mean_log_power`
  - Median:`r median_log_power`
  - Because the data is skewed, we use median as the measure of central tendency.
  - Majority of total power lies within `r IQR_power` of the median.


\newpage

# Relationships between various variables 
## Bivariate visualisations
I did a pairs plot to see the overall relationship between variables in the dataset.

```{r message=FALSE, warning=FALSE}
library(psych)
#pairs(~date+rain+temp+rhum+wdsp+factor(sun)+log(vis)+avg_temp+total_power+log(total_power),data=hourly_data_filtered)
hourly_data_filtered$log_vis = log(hourly_data_filtered$vis)
hourly_data_filtered$log_power = log(hourly_data_filtered$total_power)


pairs.panels(hourly_data_filtered[,c(2,3,6,8,9,10,11,12,13,15,16,17,18)])
```


I did a more detailed bivariate plots for the variables that I am interested in and need further investigation to determine whether the variables are linear or not. 

**I. Date**

I decided to do further investigation on Date column, especially the month, season, time and time_period because it is not shown in the pairs plot. But after doing some visualisations, I think that the season column will be enough to represent the months, so I will use the season column instead of the month column.
```{r date-temp, fig.height=9}
par(mfrow=c(3,2))
plot(~factor(season)+temp,data=hourly_data_filtered)
plot(~factor(time_period)+temp,data=hourly_data_filtered)

plot(~factor(season)+avg_temp,data=hourly_data_filtered)
plot(~factor(time_period)+avg_temp,data=hourly_data_filtered)

plot(~factor(season)+temp_diff,data=hourly_data_filtered)
plot(~factor(time_period)+temp_diff,data=hourly_data_filtered)
```
From the plots of Season/Time_period vs temperature columns (temp, avg_temp, and temp_diff), we can see that there might be a relationship between them.

- Seasons affect temperature as in Summer, both the temperature inside and outside peaked until around 20°C while Winter has the lowest temperature. On the other hand, for the temperature difference between outside and inside the house, in Summer it has the lowest temperature difference while Winter and Spring are the highest.
- For time period, Afternoon is when the temperature ooutside peaked and the lowest temperature is at Night time. While evening time is when the temperature inside the house peaked. And for the temperature difference, it peaked aroung Evening and Night time.

```{r fig.height=8}
par(mfrow=c(3,1))
plot(~factor(time_period)+rhum,data=hourly_data_filtered)
plot(~factor(season)+wdsp,data=hourly_data_filtered)
#plot(~factor(season)+(sun),data=hourly_data_filtered)
plot(~factor(season)+vis,data=hourly_data_filtered)

```
From the plots of Seasons/time period with other variables, here are the variables that I think might have a relationship with either of them.

- Humidity: Night time has the highest humidity percentage and Afternoon is the lowest.
- Wind speed: in the Summer, wind speed is at it's lowest level while Winter has the highest wind speed.
- Visibility: it is higher in the summer and the lowest visibility is in Winter.


```{r}
par(mfrow=c(2,2))
plot(~factor(season)+(total_power),data=hourly_data_filtered)
plot(~factor(time_period)+(total_power),data=hourly_data_filtered)
plot(~factor(season)+log(total_power),data=hourly_data_filtered)
plot(~factor(time_period)+log(total_power),data=hourly_data_filtered)
```
For the plot of Season/Time period vs total power, I wanted to compare them with total power and log of total power. Based on the plots, I prefer the log of total power because there are less outliers.

- **Log of total power: Power usage is affected by both season and time period. The household generally did not use much power in the summer compared to the other seasons. And the power usage is generally lower during night time than other time period of the day.**

***
**II. Rain**

I didn't see any relation between rain column and the other variables, so I wanted to see the relationship with rain_group instead.
```{r rain +, fig.height=10}
par(mfrow=c(2,2))


plot(~factor(rain_group)+temp, data = hourly_data_filtered)
plot(~factor(rain_group)+rhum, data = hourly_data_filtered)
plot(~factor(rain_group)+wdsp, data = hourly_data_filtered)
x=prop.table(table(factor(hourly_data_filtered$rain_group),factor(hourly_data_filtered$sun_factor)))
#barplot(t(x),col = c('grey',"lightblue"),ylim = c(0,1))
#legend('topright',legend = c('No Sunlight','Sun'), fill = c('grey',"lightblue"))
plot(~factor(rain_group)+vis, data = hourly_data_filtered)
#plot(~factor(rain_group)+avg_temp, data = hourly_data_filtered)
#plot(~factor(rain_group)+temp_diff, data = hourly_data_filtered)
#plot(~factor(rain_group)+log(total_power), data = hourly_data_filtered)
```
Based on the plots, there seems to be not much difference between the temperature with rain group. There are a slight difference between the wind speed and humidity of raining and not raining condition. There is a gap for visibility with each rain group so that means that raining condition might influence visibililty to decrease.
***
**III. Temperature**

I wanted to take a closer look for the variable temperature with humidity . Based on the plots, I there there is a linear relationship between these two variables.
```{r temp+, fig.height=8}
plot(~temp+rhum, data = hourly_data_filtered)
abline(lm(rhum~(temp), data = hourly_data_filtered),col = "red")
```

***
**IV. Average Temperature in the House**
```{r avg_temp+}
plot(~avg_temp+rhum, data = hourly_data_filtered)
abline(lm(rhum~(avg_temp), data = hourly_data_filtered),col = "red")
```


***
**V. Temperature Difference**
```{r temp_diff+}
plot(~temp_diff+rhum, data = hourly_data_filtered)
abline(lm(rhum~(temp_diff), data = hourly_data_filtered),col = "red")
```

***
**VI. Relative Humidity**

I took a closer look on the relationship of humidity vs temperature difference between the weather temperature and average temperature in the house. I think there might be a linear relationship between these two variables.
```{r rhum1}
plot(~rhum+temp_diff, data = hourly_data_filtered)
abline(lm(temp_diff~rhum, data = hourly_data_filtered),col = "red")
```

***
**VII. Sunshine Duration**

I do not use the sun column as it is skewed because it consists of mostly zero entries. Instead, I use the new variable from sun, which is sun_factor, and these are the variables that I think might have a correlation with sun.
```{r sun +}
par(mfrow=c(2,2))

#plot(~factor(sun_factor) + rain, data = hourly_data_filtered)
plot(~factor(sun_factor) + temp, data = hourly_data_filtered)
plot(~factor(sun_factor) + rhum, data = hourly_data_filtered)
#plot(~factor(sun_factor) + wdsp, data = hourly_data_filtered)
plot(~factor(sun_factor) + vis, data = hourly_data_filtered)
#plot(~factor(sun_factor) + avg_temp, data = hourly_data_filtered)
plot(~factor(sun_factor) + log(total_power), data = hourly_data_filtered)
```
**Log of total power: from the plot we can see that generally, the household use more power when there is sunlight.**



## Multivariate visualisations 

**1. Season and Time Period**
We can see that temperature differ depending on season and time period. The temperature is at its highest level in the Summer afternoon, while the lowest temperature is at night in Winter.
```{r}
boxplot(temp~(time_period)+(season), data = hourly_data_filtered, col=rep(c('yellow','orange','lightblue','grey'),by=4))
```

The temperature difference outside and inside the house is also affected by season and time period change. On summer afternoon, the temperature difference is the lowest, while the highest difference is in winter evening time
```{r}
boxplot(temp_diff~(season)+(time_period), data = hourly_data_filtered, col=rep(c('pink','orange','brown','lightblue'),by=4))
```

The log of total power usage is also affected by season and time period change. The household use less power at night time, and the power usage is similar for all season during night time. But the the highest power usage is when it is in fall/winter.
```{r}
boxplot(log(total_power)~(season)+(time_period), data = hourly_data_filtered, col=rep(c('pink','orange','brown','lightblue'),by=4))
```


**2. Sun and Season**
The total power are affected by the sun occurance and seasonal change. The household use less power when there is no sun in the summer, and they use the most power when there is sun in the winter.
```{r}
boxplot(log(total_power)~(season)+(sun_factor), data = hourly_data_filtered, col=rep(c('pink','orange','brown','lightblue'),by=4))
```

**3. Sun and rain**
Based on the plot, we can see that when ther is sun and rain, the power used will be much higher compared when there is not. But sun affect the total power more than rain as when there is sun but no rain, the total power will be higher compared to the other way.
```{r}
boxplot(log(total_power)~(sun_factor)+(rain_group), data = hourly_data_filtered, col=rep(c('grey','yellow'),by=2))
```


\newpage

# Research Question

- The main response variable is the total_power column as I am interested in finding the factors that might effect the total power consumption. But I discovered that the total_power is skewed and I did a log transformation which looks better so I decided to use log of total power instead. And based on the plots that I made before, season, time period, temperature, humidity, wind speed, and sunlight might be affecting the total power usage.
- Thus the research question will be:**What are the factors that affect the total power usage in the household?**



\newpage

# Simple linear regression analysis

The best SLR that I got with log of Power is Time Period.
From the summary of the model, we got these results:

- p-value: all p-value of the factors are very small
- Residual error: 0.8294  
- Multiple R-squared:  0.2751 -> 27.5% of the variability in the data is explained by the model
- Which means that the time period is significant, the Multiple R-squared means how the model represent the variability of the data and it has a value of 27.5% which is actually not very good, but this model is the best performing compared to other variables.
- The equation for this model is: **Total power = exp(9.74818)*exp(-0.21114*(Afternoon))*exp(0.10656*(Evening)) *exp(-1.12109*(Night)) **
- From the plots of the model, the QQ plot looks good even though it is a bit crooked, but the other plots are not satisfactory. This means that maybe we should proceed to the next step and consider a multiple linear regression

```{r power-date}
power_time_period = lm(log(total_power)~factor(time_period), data = hourly_data_filtered)
plot(power_time_period, which = 2)
#plot(power_time_period, which = 1)
summary(power_time_period)
```

Other variables but they are not significant or the model of the variable is not good:
```{r SLR power - other var}
#power_season = lm(log(total_power)~season, data = hourly_data_filtered)
#plot(power_season, which = 1:5)
#summary(power_season)
#power_rain = lm(log(total_power)~rain_group, data = hourly_data_filtered)
#summary(power_rain)
#power_temp = lm(log(total_power)~temp, data = hourly_data_filtered)
#plot(power_temp, which = 1:5)
#summary(power_temp)
#power_rhum = lm(log(total_power)~rhum, data = hourly_data_filtered)
#summary(power_rhum)
#power_wdsp = lm(log(total_power)~wdsp, data = hourly_data_filtered)
#summary(power_wdsp)
#power_sun = lm(log(total_power)~sun_factor, data = hourly_data_filtered)
#summary(power_sun)
#power_vis = lm(log(total_power)~log(vis), data = hourly_data_filtered)
#summary(power_vis)
#power_avg_temp = lm(log(total_power)~avg_temp, data = hourly_data_filtered)
#summary(power_avg_temp)
#power_temp_diff = lm(log(total_power)~temp_diff, data = hourly_data_filtered)
#summary(power_temp_diff)
```

1. Power + Season : The factor of Seasons are all significant with log of Power but the model is not good as the error level is high and it only represent 2.716% of the data.
  - Residual error: 0.9608 
  - Multiple R-squared:  0.02716
2. Power + Rain : It is not significant with log of Power, the model is not good as the error level is high and it only represent 3.915e-03% of the data.
3. Power + Temp : Temp is significant but the model is not good as the error level is high and it only represent 0.1204% of the data.
  - p-value:5.16e-06
  - Residual error: 0.9735 
  - Multiple R-squared:  0.001204
4. Power + Rhum : Humidity is significant with log of Power but the model is not good as the error level is high and it only represent 2.11% of the data.
  - p-value:<2e-16
  - Residual error: 0.9638  
  - Multiple R-squared:  0.0211
5. Power + Wdsp : Wind is significant with log of Power but the model is not good as the error level is high and it only represent 1.1109% of the data.
  - p-value:<2e-16
  - Residual error: 0.9687   
  - Multiple R-squared:  0.01109
6. Power + Sun_factor : The factor of sun is significant with log of Power but the model is not good as the error level is high and it only represent 2.909% of the data.
  - p-value:<2e-16
  - Residual error: 0.9598    
  - Multiple R-squared:  0.02909
7. Power + log of Vis : Visibility is significant with log of Power but the model is not good as the error level is high and it only represent 0.09% of the data.
  - p-value: 5.5e-05
  - Residual error: 0.9736      
  - Multiple R-squared:  0.0009425
8. Power + Average temp : It is not significant with log of Power, the model is not good as the error level is high and it only represent 7.286e-04% of the data.
9. Power + Temp difference : It is significant with log of Power but the model is not good as the error level is high and it only represent 0.17% of the data.
  - p-value: 3.59e-08
  - Residual error: 0.9733      
  - Multiple R-squared:  0.001758


## Predict the response variable
```{r predict SLR}
#we take hourly_data_filtered[1245,] randomly to test if the model can predict the power 
hourly_data_filtered[1245,] 
power = hourly_data_filtered[1245,]$total_power
time_period = 'Evening'

#use exp as log of power
model_predict =exp(9.74818)*exp(-0.21114*0)*exp(0.10656*1)* exp(-1.12109*0) 
#with total_power
residual= model_predict-power
residual
```
The model produced a result of 19048.43 for total power from the data with row number 1245. The real total power is supposed to be 22606 which means that the difference with the predictive value is around -3557.569 (percentage of error -15.7%) 

## Justify model
Even though the assumptions are met (all variables are significant and the Multiple R squared is the highest compared to other variables), I think we can still improve the model with adding more variables. Then we need to proceed to the next step and consider making a multiple linear regression model.

## Interpretation of results
The equation for this model is: 
**Total power = exp(9.74818)*exp(-0.21114*(Afternoon))*exp(0.10656*(Evening)) *exp(-1.12109*(Night)) ** which means that

- If the time period is Afternoon, it leads to on average a decrease of exp(-0.21114) in log of power measure, while keeping the other predictors constant.
- If the time period is Evening, it leads to on average a increase of exp(0.10656) in log of power measure, while keeping the other predictors constant.
- If the time period is Night, it leads to on average a decrease of exp(-1.12109) in log of power measure, while keeping the other predictors constant.

\newpage

# Multiple linear regression analysis
**1. MLR 1**

In this model, I fit all the variables that I think might have a relationship with total power and I will see how the model perform. I am also going to make a model with log of power and see which one is better
```{r}
MLR1 = lm((total_power)~factor(season)+factor(time_period)+factor(rain_group)+temp+avg_temp+temp_diff+rhum+wdsp+factor(sun_factor)+log_vis, data = hourly_data_filtered)
plot(MLR1, 1:2)
plot(MLR1, 4)
summary(MLR1)

MLR1_log = lm(log(total_power)~factor(season)+factor(time_period)+factor(rain_group)+temp+avg_temp+temp_diff+rhum+wdsp+factor(sun_factor)+log_vis, data = hourly_data_filtered)
plot(MLR1_log, 1:2)
plot(MLR1_log, 4)
summary(MLR1_log)
```
After comparing the model of power and log of power, I decided to go with **log of power** as the R-squared value is higher and the QQ plot also looks better for log of power.

From the summary of model, especially the Cook's distance, I notice that the data with row number 15257 seems to be an outlier. So I decided to remove that row.

```{r}
hourly_data_filtered[15257,]
hourly_data_filtered1 = hourly_data_filtered[-15257,]
```

```{r}
MLR1 = lm(log(total_power)~factor(season)+factor(time_period)+factor(rain_group)+temp+avg_temp+temp_diff+rhum+wdsp+factor(sun_factor)+log_vis, data = hourly_data_filtered1)
plot(MLR1, 1:2)
plot(MLR1, 4)
summary(MLR1)
```
- Based on the model, it is better compared to the SLR before. Few informations that we consider from the summary of the model:
  - p-value: everything except log of visual are significant
  - Residual standard error: 0.7911
  - Multiple R-squared:  0.3397
  - Adjusted R-squared:  0.3392
- Based on the plot:
  - Res vs Fitted: The plot is good with random scatter and the red line in the middle
  - QQ Plot: It started a bit crooked but overall the QQ plot seems to look fine as there is no jump in the middle.
  - Cook's distance: The cook's distance show that there is no significant outliers in the data


We check the interaction plot between Season and Time period to see if those two variables are connected and affect the log of Power
```{r}
library(car)
interaction.plot(x.factor = hourly_data_filtered$season, 
                 trace.factor = hourly_data_filtered$time_period, 
                 response = hourly_data_filtered$log_power,
                 fun = mean, trace.label ="Avg temp",
                 type = "b", legend = TRUE, 
                 xlab = "Diet Type", ylab="Weight Loss",
                 pch=c(1,19),col=c(2,4))
Anova(MLR1, type="2")
```
- Based on the interaction plot, we conclude that there is an interaction between them as there are lines crossing. And as both factors are significant in the Anova test, we should keep these two variables.

**2. MLR2**

In this second model, I decided to **remove log of visibility** as this variable is not significant.

```{r MLR2}
#remove log(vis)
MLR2 = lm(log(total_power)~factor(season)+factor(time_period)+factor(rain_group)+temp+avg_temp+temp_diff+rhum+wdsp+factor(sun_factor), data = hourly_data_filtered1)
plot(MLR2, 1:2)
plot(MLR2, 4:5)
summary(MLR2)
```
- Based on the model, it is better compared to the MLR before. But there seems to be no difference in how the model is performing, as all the Residual standard error and the R-squared value are all the same with MLR1.

Then I decide to check the AIC and BIC to see which model is prefered
```{r warning=FALSE}
library(car)
#check which model is prefered with AIC and BIC
AIC(MLR2,MLR1)
BIC(MLR2,MLR1)
# model 2 is prefered, check VIF for multicolinearity
vif(MLR2)
```
From the VIF, we can see that temp, avg_temp, and temp difference have a high GVIF value, so we need to check those three variables for multicolinearity.

**3. MLR3**

From the VIF of MLR2, I decided to remove temp as it has the highest value of VIF.
```{r}
MLR3 = lm(log(total_power)~factor(season)+factor(time_period)+factor(rain_group)+temp_diff+avg_temp+rhum+wdsp+factor(sun_factor), data = hourly_data_filtered1)
summary(MLR3)
plot(MLR3, which = 1:2)
plot(MLR3, which = 4)
vif(MLR3)
```
- Based on the model, it is better compared to the SLR before. Few informations that we consider from the summary of the model:
  - p-value: every variable is significant
  - Residual standard error: 0.7934 
  - Multiple R-squared:  0.3357
  - Adjusted R-squared:  0.3352 
- Based on the plot:
  - Res vs Fitted: The plot is good with random scatter and the red line in the middle
  - QQ Plot: It started a bit crooked but overall the QQ plot seems to look fine as there is no jump in the middle.
  - Cook's distance: The cook's distance show that there is no significant outliers in the data
  

## Comparing MLR Model
```{r}
anova(MLR1,MLR2,MLR3)
AIC(MLR3,MLR2,MLR1)
BIC(MLR3,MLR2,MLR1)
```

The anova table suggest that the MLR3 is better, but both AIC and BIC suggest that MLR2 is better. However, I am still not sure about MLR2 as it has a high VIF for temperature which we need to take into account about multicolinearity. So I am going to test both MLR2 and MLR3 to see which model perform better.


## Predict the response variable
**MLR2**

```{r}
#we take hourly_data_filtered[1245,] randomly to test if the model can predict the power 
hourly_data_filtered[1245,] 
power = hourly_data_filtered[1245,]$total_power
#variables
summer =0
fall=0
winter=1
afternoon =0
evening =1
night=0
rain = 0
temp=8.2
avg_temp=15.22
temp_diff=7.02	
rhum=93
wdsp=9
sun=0


model_predict = exp(9.0456735-0.4459570*(summer)-0.0338194*(fall)+0.1288973*(winter)-0.2208152*(afternoon)-0.0266103*(evening)-1.1938469*(night)+0.0680818*(rain)-0.1204295*(temp)+0.1693025*(avg_temp)-0.0735678*(temp_diff)-0.0043739*(rhum)+0.0086288*(wdsp)-0.0491540*(sun))

#with total_power
residuals = model_predict - power
residuals
```
The MLR2 model produced a result of 19764.91 for total power from the data with row number 1245. The real total power is supposed to be 22606 which means that the difference with the predictive value is around -2841.095 (percentage of error -12.56788%). The results indicate that MLR2 is better than our previous SLR model.


**MLR3**

```{r}
#we take hourly_data_filtered[1245,] randomly to test if the model can predict the power 
hourly_data_filtered[1245,] 
power = hourly_data_filtered[1245,]$total_power
#variables
summer =0
fall=0
winter=1
afternoon =0
evening =1
night=0
rain = 0
avg_temp=15.22
temp_diff=7.02	
rhum=93
wdsp=9
sun=0

model_predict = exp(8.9742291-0.4636001*(summer)-0.0357655*(fall)+0.1327033*(winter)-0.2294042*(afternoon)-0.0297290*(evening)-1.1961297*(night)+0.0690692*(rain)+0.0504833*(avg_temp)+0.0481939*(temp_diff)-0.0039437*(rhum)+0.0089316*(wdsp)-0.0562076*(sun))

#with total_power
residuals=model_predict-power
residuals
```
The MLR3 model produced a result of 19880.62 for total power from the data with row number 1245. The real total power is supposed to be 22606 which means that the difference with the predictive value is around -2725.379 (**percentage of error -12.056%**). IF we compared with MLR2, MLR2 performed better than MLR3, but there are not much difference between them.


## Justify model
Both MLR2 and MLR3 are able to predict the response variable(total_power) better than the SLR. But **I decided to choose MLR3** to be the predictive model as the VIF contains all low values which indicates there is no multicollinearity in the model and after reducing a variable, the model's R-squared value did not change drastically which is good as we have more degree of freedom.


## Interpretation of results
The equation for this model is: 
**Total power = exp(8.9742291-0.4636001*(summer)-0.0357655*(fall)+0.1327033*(winter)-0.2294042*(afternoon)-0.0297290*(evening)-1.1961297*(night)+0.0690692*(rain)+0.0504833*(avg_temp)+0.0481939*(temp_diff)-0.0039437*(rhum)+0.0089316*(wdsp)-0.0562076*(sun)) ** which means that

- If the season is Summer, it leads to on average a decrease of exp(-0.4636001) in log of power measure, while keeping the other predictors constant.
- If the season is Fall, it leads to on average a decrease of exp(-0.0357655) in log of power measure, while keeping the other predictors constant.
- If the season is Winter, it leads to on average a increase of exp(0.1327033) in log of power measure, while keeping the other predictors constant.

- If the time period is Afternoon, it leads to on average a decrease of exp(-0.2294042) in log of power measure, while keeping the other predictors constant.
- If the time period is Evening, it leads to on average a decrease of exp(-0.0297290) in log of power measure, while keeping the other predictors constant.
- If the time period is Night, it leads to on average a decrease of exp(-1.1961297) in log of power measure, while keeping the other predictors constant.

- If the time period is Afternoon, it leads to on average a decrease of exp(-0.2294042) in log of power measure, while keeping the other predictors constant.
- If the time period is Evening, it leads to on average a decrease of exp(-0.0297290) in log of power measure, while keeping the other predictors constant.
- If the time period is Night, it leads to on average a decrease of exp(-1.1961297) in log of power measure, while keeping the other predictors constant.

## Comparison with SLR
```{r warning=FALSE}
SLR=power_time_period
AIC(SLR,MLR3)
BIC(SLR,MLR3)
```
Based on the test of AIC and BIC, I conclude that MLR3 is preferred than the SLR because both in AIC and BIC, the MLR has a lower score which indicated that this model is better. So, I decided to choose MLR3 as my final model to predict the total power usage.

\newpage
# Conclusion
Based on the SLR and MLR models that I did, I decided to pick MLR3 as the best performing model to predict the total usage of power in the house. The equation of MLR3 is:

**Total power = exp(8.9742291-0.4636001*(summer)-0.0357655*(fall)+0.1327033*(winter)-0.2294042*(afternoon)-0.0297290*(evening)-1.1961297*(night)+0.0690692*(rain)+0.0504833*(avg_temp)+0.0481939*(temp_diff)-0.0039437*(rhum)+0.0089316*(wdsp)-0.0562076*(sun)) **

And it means that **season, time period of the day, rain, average temperature in the house, temperature difference between the temperature inside and outside the house, humidity percentage, wind speed, and whether there is sun or not,** are the variables that will affect the total power usage in the house.
